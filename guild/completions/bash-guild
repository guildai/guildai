#-*-shell-script-*-
_guild_completion() {
    local IFS=$'\n'
    local response

    response=$(env COMP_WORDS="${COMP_WORDS[*]}" COMP_CWORD=$COMP_CWORD _GUILD_COMPLETE=bash_complete $1)

    COMP_WORDBREAKS='"'"'"'><=;|&(: '  # Reset as can be modified below.
    for completion in $response; do
        IFS=',' read type value <<< "$completion"
        if [ "$value" = "!!nospace" ]; then
            compopt -o nospace
            continue
        elif [ "$value" = "!!no-colon-wordbreak" ]; then
            # Dangerous as this effects other completions. The damage
            # is mitigated by resetting COMP_WORDBREAKS above but this
            # is still not ideal.
            COMP_WORDBREAKS='"'"'"'><=;|&( '
            continue
        fi
        if [[ $type == 'dir' ]]; then
            COMPREPLY=()
            compopt -o dirnames
        elif [[ $type == 'file' ]]; then
            COMPREPLY=()
            compopt -o default
        elif [[ $type == 'plain' ]]; then
            COMPREPLY+=($value)
        fi
    done

    return 0
}

_guild_completion_setup() {
    complete -o nosort -F _guild_completion guild
}

_guild_completion_setup;
